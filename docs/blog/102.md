---
layout: default
title: PXE boot Server
parent: Blog
grand_parent: Category
permalink: docs/category/blog/102
child_nav_order: desc
---
# PXE boot Server
{: .no_toc}

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---
## 개요

> - PXE(Pre-boot eXecution Environment) boot Server
> - [참조](https://ubuntu.com/server/docs/install/netboot-amd64)
{: .new }

### 패키지 설치
```bash
apt install -y tftp-hpa tftpd-hpa isc-dhcp-server syslinux-common pxelinux
```

### PXE 부팅을 위한 디렉토리 생성 및 다운로드

```bash
wget https://releases.ubuntu.com/focal/ubuntu-20.04.6-live-server-amd64.iso -O ubuntu-20.04.6-live-server-amd64.iso
wait
```

### ISO 마운트 후 부팅을 위한 파일 복사

```bash
mkdir -p /srv/tftp/u20/pxelinux.cfg
mount -o ro,loop ~/ubuntu-20.04.6-live-server-amd64.iso /mnt
cp -a /mnt/casper/{vmlinuz,initrd} /srv/tftp/u20/
wait

umount /mnt
```

### Syslinux와 PXELINUX 파일 복사

```bash
cp -a /usr/lib/syslinux/modules/bios/ldlinux.c32 /srv/tftp/u20/
cp -a /usr/lib/PXELINUX/pxelinux.0 /srv/tftp/u20/
```



### PXELINUX 설정 파일 생성

```bash
#IPADD=$(hostname -I | tr -d ' ')
IPADD=$(hostname -I | cut -d ' ' -f 1)

tee /srv/tftp/u20/pxelinux.cfg/default << EOF
DEFAULT install
  LABEL install
  KERNEL vmlinuz
  INITRD initrd
  APPEND root=/dev/ram0 ramdisk_size=1500000 ip=dhcp url=http://$IPADD/ubuntu-20.04.6-live-server-amd64.iso
EOF
```
### DHCP 서버 설정 업데이트

```bash
IPADD=$(hostname -I | awk '{print $1}')
IPGW=$(ip route | grep default | head -n 1 | awk '{print $3}')
IPADD_PREFIX=$(echo $IPADD | sed 's/\.[0-9]*$//')
cat << EOF >> /etc/dhcp/dhcpd.conf

subnet 192.168.0.0 netmask 255.255.255.0 {
 option routers                  $IPGW;
 option subnet-mask              255.255.255.0;
 option domain-name-servers      1.1.1.1, 8.8.8.8;
 #  option domain-name              "in.infra.com";
 option time-offset              32400;     # Timezone: Asia/Seoul
 range $IPADD_PREFIX.100 $IPADD_PREFIX.200;
 next-server $IPADD;
 filename "u20/pxelinux.0";
}
EOF
```

### TFTP 서버 및 DHCP 서버 재시작

```bash
systemctl restart tftpd-hpa.service
systemctl restart isc-dhcp-server
```

> **정상** 로드 중 멈춤 현상 시 아래 원인
> - 네트워크 문제
> - 서버 리소스 부족
> - 방화벽 또는 보안 설정
{: .important }


### WebServer

```bash
python3 -m http.server 80
```

> - `nginx` or `apache`와 같은 Web 서버 사용 가능
{: .important }
