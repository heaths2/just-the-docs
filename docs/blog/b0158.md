---
layout: default
title: SYSTEMD-TMPFILES 사용법
parent: Blog
grand_parent: Category
permalink: docs/category/blog/b0158
child_nav_order: desc
---

# SYSTEMD-TMPFILES 사용법

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .no_toc .text-delta .label .label-green }
1. TOC
{:toc}
</details>

---

## 개요

> - SYSTEMD-TMPFILES 사용법
{: .new }

### systemd-tmpfiles

{: .important }
> **tmpfiles.d** 기본 디렉토리
>
| **경로**                  | **설명**                                               | **사용 목적 및 예시** |
|---------------------------|--------------------------------------------------------|-----------------------|
| **`/etc/tmpfiles.d/`**     | - **사용자 또는 시스템 관리자**가 정의한 규칙을 저장합니다. <br> - 시스템 소프트웨어와 무관한 **사용자 지정 정책**을 설정할 때 사용합니다. | - `/tmp` 디렉터리 정리 주기 변경<br> - 특정 파일 유지/삭제 규칙 추가 |
| **`/usr/lib/tmpfiles.d/`** | - **시스템 소프트웨어**가 기본 제공하는 규칙 파일을 저장합니다.<br> - 주로 배포판이나 서비스에서 기본 제공하는 설정입니다. | - 시스템 서비스가 필요한 디렉터리 생성<br> - `/var` 경로 초기화 규칙 등 |
| **`/run/tmpfiles.d/`**     | - **런타임 시 동적**으로 생성된 규칙을 저장합니다.<br> - 재부팅하면 내용이 사라지며, 임시로 필요한 규칙을 정의합니다. | - 특정 서비스가 시작될 때 동적으로 생성<br> - 임시 파일에 대한 설정 |

```bash
echo "\
# tmpfiles.d configuration file
# This configuration manages the cleanup of /tmp directory

# Type   Path                            Mode    UID     GID     Age     Arguments
# --------------------------------------------------------------------------------
# 'd' type ensures that the /tmp directory exists and cleans up empty directories 
# older than the specified 'Age'. In this case, it deletes empty directories older than 7 days.
D       /tmp                            1777    root    root    7d      -

# 'x' type excludes certain files or directories from being deleted.
# In this case, any file with a .log extension in the /tmp directory is excluded from cleanup.
x       /tmp/*.log                      -       -       -       -       -" \
| sudo tee /etc/tmpfiles.d/tmp.conf
```

#### 파일에 생성된 적용된 규칙 적용 (--create)

```bash
sudo  systemd-tmpfiles --create /etc/tmpfiles.d/tmp.conf
```

#### 적용된 규칙 확인 (--cat-config)

```bash
sudo systemd-tmpfiles --cat-config | grep -w /tmp
```

#### 수동으로 즉시 적용하기

- **수동 명령어**

```bash
sudo systemd-tmpfiles --clean
```

#### 서비스 적용하기

- **서비스 등록 명령어**

```bash
sudo systemctl restart systemd-tmpfiles-clean
```

- **타이머 상태 확인**

```bash
systemctl list-timers | grep systemd-tmpfiles-clean
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }
  
```bash
Thu 2024-08-22 10:32:01 KST 23h left    Wed 2024-08-21 10:32:01 KST 27min ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service
```

</details>



