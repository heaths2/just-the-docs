---
layout: default
title: Kolla-Ansible
parent: Blog
grand_parent: Category
permalink: docs/category/blog/b0166
child_nav_order: desc
---

# Kolla-Ansible 구성

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .no_toc .text-delta .label .label-green }
1. TOC
{:toc}
</details>

---

## 개요

{: .new }
> - Kolla-Ansible 구성
> - [Kolla-Ansible Documents](https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html)

### 설치 가이드

#### **종속성 설치**

```bash
sudo apt update
# sudo apt install -s git python3-dev python3-venv python3-pip libffi-dev gcc libssl-dev
sudo apt install -y git python3-dev python3-venv python3-pip libffi-dev gcc libssl-dev
```

{: .note }
> - 가상환경 구성 후 종속성 설치 하는경우 
> - 다른 프로젝트 간의 패키지 버전 충돌이 발생 방지
> 
```bash
python3 -m venv kolla-ansible/venv
source kolla-ansible/venv/bin/activate
```
>
```bash
cp -rv kolla-ansible/venv/share/kolla-ansible/etc_examples/kolla/* /etc/kolla
cp -v kolla-ansible/venv/share/kolla-ansible/ansible/inventory/all-in-one .
```

#### **종속성 설치**

```bash
pip install -U pip
pip install 'ansible-core>=2.16,<2.17.99'
```

#### **Kolla-ansible 설치**

```bash
# pip install git+https://opendev.org/openstack/kolla-ansible@master
pip install git+https://opendev.org/openstack/kolla-ansible@stable/2024.2
```

```bash
sudo mkdir -pv /etc/kolla
sudo chown $USER:$USER /etc/kolla
mkdir -pv ~/kolla-ansible
cp -rv /usr/local/share/kolla-ansible/etc_examples/kolla/* /etc/kolla
cp -v /usr/local/share/kolla-ansible/ansible/inventory/all-in-one /root/kolla-ansible
```

#### **Ansible Galaxy 설치 요구 사항**

```bash
kolla-ansible install-deps
```

#### **초기 구성 준비**

**Kolla passwords**

```bash
kolla-genpwd
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }
  
```bash
WARNING: Passwords file "/etc/kolla/passwords.yml" is world-readable. The permissions will be changed.
```

</details>

**Kolla globals.yml**

```bash
sed -i -e 's/^#kolla_base_distro: "rocky"/kolla_base_distro: "ubuntu"/' \
       -e 's/^#network_interface: .*/network_interface: "eth1"/' \
       -e 's/^#neutron_external_interface: .*/neutron_external_interface: "eth0"/' \
       -e 's/^#kolla_internal_vip_address: .*/kolla_internal_vip_address: "10.1.81.200"/' \
       -e 's/^#kolla_external_vip_address: .*/kolla_external_vip_address: "192.168.0.222"/' \
       -e 's/^#enable_keystone: .*/enable_keystone: "yes"/' \
       -e 's/^#enable_horizon: .*/enable_horizon: "yes"/' \
#       -e 's/^#enable_haproxy: "yes"/enable_haproxy: "yes"/' \
       /etc/kolla/globals.yml
```

#### **Deployment**

```bash
cd ~/kolla-ansible
kolla-ansible bootstrap-servers -i ./all-in-one
kolla-ansible prechecks -i ./all-in-one
kolla-ansible deploy -i ./all-in-one
```

{: .note }
> 오류메시지
```bash
TASK [prechecks : Fail if nscd is running] *********************************************************************************************************************************************************
fatal: [localhost]: FAILED! => {"changed": false, "msg": "Service nscd is running. This is known to cause issues with Docker's user namespaces in\nKolla. Please disable it before proceeding.\n"}
                                                 
PLAY RECAP *****************************************************************************************************************************************************************************************
localhost                  : ok=14   changed=0    unreachable=0    failed=1    skipped=6    rescued=0    ignored=0
```
> 조치 방법
```bash
systemctl disable --now nscd.service
systemctl mask nscd.service
```


**OpenStack CLI 클라이언트 설치**

```bash
pip install python-openstackclient -c https://releases.openstack.org/constraints/upper/2024.2
```

**관리자 사용자에 대한 자격 증명 파일 생성**

```bash
kolla-ansible post-deploy
```
