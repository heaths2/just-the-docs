---
layout: default
title: Internet Small Computer System Interface
parent: Blog
grand_parent: Category
permalink: docs/category/blog/b0159
child_nav_order: desc
---

# iSCSI 구성

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .no_toc .text-delta .label .label-green }
1. TOC
{:toc}
</details>

---

## 개요

> - iSCSI 구성
{: .new }

### iSCSI Target

#### SCST 설치

##### **필수 패키지 설치**

```bash
sudo apt update
sudo apt install build-essential debhelper devscripts gcc make linux-headers-$(uname -r) lintian quilt
```

##### **SCST 소스 코드 다운로드**

```bash
git clone https://github.com/SCST-project/scst.git
cd scst
```

##### **SCST Debian 패키지(.deb) 파일로 패키징 및 설치**

```bash
make dpkg
sudo dpkg -i ./dpkg/{scst,iscsi-scst,scstadmin}_*.deb
```

##### **SCST 모듈 로드**

```bash
sudo modprobe scst
sudo depmod
sudo modprobe iscsi-scst
sudo modprobe scst_disk scst_tape scst_processor scst_cdrom scst_modisk scst_changer scst_raid scst_vdisk scst_user
```

##### **SCST 자동 모듈 로드 설정**

```bash
echo "\
iscsi-scst
scst_vdisk
scst_disk
scst_user
scst_modisk
scst_processor
scst_raid
scst_tape
scst_cdrom
scst_changer" | sudo tee -a /etc/modules
```

{: .important }
> **SCST 모듈**
>
> | 모듈 이름        | 설명                                                     | 장치 유형 (Type)                   |
> |:-----------------|:--------------------------------------------------------|:-----------------------------------|
> | scst             | SCST 자체 (핵심 모듈)                                    | N/A                                |
> | iscsi-scst       | iSCSI 타겟 기능을 제공하는 모듈                          | N/A                                |
> | scst_disk        | 디스크용 장치 핸들러                                     | 0 (디스크)                         |
> | scst_tape        | 테이프용 장치 핸들러                                     | 1 (테이프)                         |
> | scst_processor   | 프로세서용 장치 핸들러                                   | 3 (프로세서)                       |
> | scst_cdrom       | CD-ROM용 장치 핸들러                                     | 5 (CD-ROM)                         |
> | scst_modisk      | MO 디스크용 장치 핸들러                                  | 7 (MO 디스크)                      |
> | scst_changer     | 미디어 체인저용 장치 핸들러                              | 8 (미디어 체인저)                  |
> | scst_raid        | 스토리지 배열 컨트롤러(예: RAID)용 핸들러                | C (스토리지 배열 컨트롤러)         |
> | scst_vdisk       | 가상 디스크(파일, 장치 또는 ISO CD 이미지)용 핸들러     | N/A                                |
> | scst_user        | 사용자 공간에서 동작하는 장치 핸들러                     | N/A                                |

#### **SCST 서비스 관리**

##### **SCST 서비스 시작**

```bash
systemctl start scst.service
```

##### **SCST 자동 시작 설정 설정**

```bash
systemctl enable scst
```

##### **SCST 기본 설정 생성**

```bash
sudo scstadmin -write_config /etc/scst.conf
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }

```bash
# Automatically generated by SCST Configurator v3.9.0-pre.


HANDLER vdisk_blockio {
    DEVICE disk01 {
        filename /dev/Disks/data01
        blocksize 512
        nv_cache 0
        read_only 0
        removable 0
    }
    DEVICE disk02 {
        filename /dev/Disks/data02
        blocksize 4096
        nv_cache 1
        read_only 0
        removable 0
    }
    DEVICE disk03 {
        filename /dev/Disks/data03
    }    
}

TARGET_DRIVER iscsi {
    enabled 1

    TARGET iqn.infra.com:bob {
        LUN 0 disk01
        LUN 1 disk02

        enabled 1

        INITIATOR iqn.infra.com:bob
    }
    TARGET iqn.infra.com:ace {
        enabled 1

        GROUP ace {
            LUN 0 disk03
            INITIATOR iqn.infra.com:ace
        }
    }
}
```

</details>

```bash
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/{filename,blocksize,nv_cache,read_only,removable}
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/filename
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/blocksize
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/nv_cache
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/read_only
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/removable
cat /sys/kernel/scst_tgt/handlers/vdisk_blockio/*/naa_id
```

```bash
ls /sys/kernel/scst_tgt/targets/iscsi/
```

##### **SCST 설정 적용**

```bash
sudo scstadmin -config /etc/scst.conf
```

##### **SCST 상태 확인**

```bash
sudo scstadmin -list_target -driver iscsi
```

### iSCSI Initiator

```bash
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }
  
```bash

```

</details>
