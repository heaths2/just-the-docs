---
layout: default
title: FreeRADIUS Configure
parent: Blog
grand_parent: Category
permalink: docs/category/blog/b0147
child_nav_order: desc
---

# Interworking FreeRADIUS with FortiGate

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .no_toc .text-delta .label .label-green }
1. TOC
{:toc}
</details>

---

## 개요

> - FreeRADIUS Configure
> - Interworking FreeRADIUS with FortiGate
{: .new }

### 

- 필수 패키지 설치

```bash
apt update
apt-get install -y freeradius freeradius-postgresql postgresql
```

- PostgreSQL DATABASE 설정

```bash
sudo -u postgres psql -c "CREATE USER radius WITH PASSWORD 'qwer1234';"
sudo -u postgres psql -c "CREATE DATABASE radius;"
sudo -u postgres psql radius < /etc/freeradius/3.0/mods-config/sql/main/postgresql/schema.sql
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE nas TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE radreply TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE radgroupcheck TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE radgroupreply TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE radusergroup TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE radpostauth TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE radacct TO radius;"
sudo -u postgres psql -d radius -c "GRANT SELECT, INSERT, UPDATE, DELETE ON TABLE nas TO radius;"
```

- SQL Data 입력

```bash
sudo -u postgres psql -d radius -c "INSERT INTO radcheck (username, attribute, op, value) VALUES ('bob', 'Cleartext-Password', ':=', 'qwer1234');"
sudo -u postgres psql -d radius -c "INSERT INTO radcheck (username, attribute, op, value) VALUES ('alice', 'Cleartext-Password', ':=', 'qwer1234');"
sudo -u postgres psql -d radius -c "INSERT INTO radusergroup (username, groupname, priority) VALUES ('bob', 'RadiusUsers', 1);"
sudo -u postgres psql -d radius -c "INSERT INTO radusergroup (username, groupname, priority) VALUES ('alice', 'RadiusUsers', 1);"
```

- SQL radcheck Tables Data 조회

```bash
sudo -u postgres psql -d radius -c "SELECT * FROM radcheck;"
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }
  
```bash
 id | username |     attribute      | op |  value   
----+----------+--------------------+----+----------
  1 | bob      | Cleartext-Password | := | qwer1234
  2 | alice    | Cleartext-Password | := | qwer1234
(2 rows)
```

</details>

- SQL radusergroup Tables Data 조회

```bash
sudo -u postgres psql -d radius -c "SELECT * FROM radusergroup;"
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }
  
```bash
 id | username |  groupname  | priority 
----+----------+-------------+----------
  1 | bob      | RadiusUsers |        1
  2 | alice    | RadiusUsers |        1
(2 rows)
```

</details>

- sql 심볼릭 링크 파일 생성

```bash
cd /etc/freeradius/3.0/mods-enabled
ln -s ../mods-available/sql sql
chown -h $(id -u freerad):$(id -g freerad) sql
```

- PostgreSQL DB 설정

```bash
sed -i -e 's/dialect = "sqlite"/dialect = "postgresql"/' \
       -e 's/driver = "rlm_sql_null"/#&/' \
       -e '/driver = "rlm_sql_${dialect}"/ s/^#//' \
       -e '/server = "localhost"/ s/^#//' \
       -e '/port = 3306/ s/^#//' \
       -e 's/port = 3306/port = 5432/' \
       -e '/login = "radius"/ s/^#//' \
       -e '/read_clients = yes/ s/^#//' \
       -e '/password = "radpass"/ s/^#//' \
       -e 's/password = "radpass"/password = "qwer1234"/' /etc/freeradius/3.0//mods-available/sql
```

- FortiGate 접속 정보 등록

```bash
echo "
client FortiGate-60E {
        ipaddr = 10.1.0.0
        netmask = 24
        port = 1812
        proto = *
        secret = qwer1234
        require_message_authenticator = no
}" >> /etc/freeradius/3.0/clients.conf
```

- FortiGate RADIUS 서버 등록

```bash
config user radius
    edit "if-radius"
        set server "10.1.1.100"
        set secret qwer1234
    next
end
```

- FortiGate & Test User Credentiials

```bash
diagnose test authserver radius if-radius pap bob qwer1234
```

<details markdown="block">
  <summary>
    코드
  </summary>
  {: .text-delta .label .label-green }
  
```bash
authenticate 'bob' against 'pap' succeeded, server=primary assigned_rad_session_id=1864367789 session_timeout=0 secs idle_timeout=0 secs!
```

</details>
