---
layout: default
title: Ansible AWX-Operator Install
parent: Blog
grand_parent: Category
permalink: docs/category/blog/91
child_nav_order: desc
---
# Ansible AWX-Operator Install
{: .no_toc}
## Table of contents
{: .no_toc .text-delta }
1. TOC
{:toc}
---
## 개요
> - Ansible AWX Install 가이드
> - [awx-operator 설치](https://github.com/ansible/awx-operator)
> - [docker 설치](https://docs.docker.com/engine/install/ubuntu/)
> - [docker 권한](https://docs.docker.com/engine/install/linux-postinstall/)
> - [Minikube 설치](https://minikube.sigs.k8s.io/docs/start/)
> - [tag 정보](https://github.com/ansible/awx-operator/tags)
> - [k3s](https://github.com/k3s-io/k3s)
> - [유튜브 참조](https://youtu.be/n3SzwzbxfRE)
{: .new }
### Install using the apt repository

```bash
# Set up the repository
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
```

```bash
# Add Docker’s official GPG key
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

```bash
# Use the following command to set up the repository
echo \
  "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

### Install Docker Engine

```bash
# Update the apt package index
sudo apt-get update
```

```bash
# Install Docker Engine, containerd, and Docker Compose.
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

```bash
# aws 계정 생성
useradd -m awx -d /home/awx -p `openssl passwd 1234` -s /bin/bash -c awx
```

```bash
# sudo 계정 추가
vi /etc/sudoers
awx     ALL=(ALL:ALL) ALL
```

```bash
# 사용자 전환
su - awx
```

```bash
# Create the docker group.
sudo groupadd docker
```

```bash
# Add your user to the docker group.
sudo usermod -aG docker $USER
```

```bash
# Log out and log back in so that your group membership is re-evaluated.
newgrp docker
```

```bash
# 현재 권한으로 docker가 실행 되는지 확인
docker run hello-world
docker ps -a
-------------------------------------------------------------------------------
CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
f2a76cad82e3   hello-world   "/hello"   15 seconds ago   Exited (0) 14 seconds ago             focused_mayer
-------------------------------------------------------------------------------
docker rm f2a76cad82e3
docker rmi hello-world:latest
docker images
```

```bash
# 안될 시 소유권 변경
sudo chown "$USER":"$USER" /home/"$USER"/.docker -R
sudo chmod g+rwx "$HOME/.docker" -R
```

### minikube Installation

```bash
# 가장 최근 패키지 다운
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube_latest_amd64.deb
# minikube 설치
sudo dpkg -i minikube_latest_amd64.deb
# minikube 버전 확인
minikube version
```

>
```bash
# root 계정
minikube start --cpus=4 --memory=6G --addons=ingress --force
```
>
{: .highlight }

```bash
# 서비스 등록
echo '[Unit]
Description=Minikube
After=docker.service

[Service]
Type=simple
User=root
ExecStart=/usr/bin/minikube start --cpus=4 --memory=6G --addons=ingress --force
WorkingDirectory=/root/awx
ExecStartPost=/usr/bin/minikube kubectl -- apply -k.
#ExecStartPost=/usr/bin/minikube kubectl -- config set-context --current --namespace=awx
Restart=always

[Install]
WantedBy=default.target' | sudo tee /etc/systemd/system/minikube.service
```

```bash
# awx 계정
minikube start --cpus=4 --memory=6G --addons=ingress
```

```bash
minikube kubectl -- get nodes
minikube kubectl -- get pods -A
minikube kubectl -- get replicaset -A
minikube kubectl -- get replicaset,pods -A
```

```bash
# Basic Install
LTS_TAG=`curl -s https://api.github.com/repos/ansible/awx-operator/releases/latest | grep tag_name | cut -d '"' -f 4`

tee kustomization.yaml << EOF
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  # Find the latest tag here: https://github.com/ansible/awx-operator/releases
  - github.com/ansible/awx-operator/config/default?ref=$LTS_TAG
  - awx-server.yaml
# Set the image tags to match the git version from above
images:
  - name: quay.io/ansible/awx-operator
    newTag: $LTS_TAG
# Specify a custom namespace in which to install AWX
namespace: awx
EOF
```

```bash
tee awx-server.yaml << EOF
---
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx-server
spec:
  service_type: nodeport
  nodeport_port: 30080
EOF
```

>
```bash
alias kubectl="minikube kubectl --"
```
>
{: .highlight }

```bash
kubectl apply -k .
kubectl get pods -n awx

kubectl config set-context --current --namespace=awx
```

```bash
kubectl get svc
kubectl get pods -l "app.kubernetes.io/managed-by=awx-operator"
kubectl get svc -l "app.kubernetes.io/managed-by=awx-operator"
```

```bash
minikube service awx-server-service -n awx --url
minikube service awx-server-service -n awx
```

```bash
kubectl get secret awx-server-admin-password -o jsonpath="{.data.password}" | base64 --decode ; echo
```

```bash
# Log 확인
kubectl logs -f deployments/awx-operator-controller-manager -c awx-manager -n awx
```

```bash
# VirtualBox External IP 설정
kubectl port-forward service/awx-server-service --address 0.0.0.0 30080:80
```

```bash
# Kubernetes Dashboard
minikube dashboard
```
