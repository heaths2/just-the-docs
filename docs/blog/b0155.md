---
layout: default
title: Linux iptables
parent: Blog
grand_parent: Category
permalink: docs/category/blog/b0155
child_nav_order: desc
---

# Linux iptables ÏÇ¨Ïö©Î≤ï

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .no_toc .text-delta .label .label-green }
1. TOC
{:toc}
</details>

---

## Í∞úÏöî

> - Linux iptables ÏÇ¨Ïö©Î≤ï
{: .new }

### iptables ÏÇ¨Ïö©Î≤ï

> - `iptables` ÏòµÏÖò
> 
| Î™ÖÎ†πÏñ¥ (Îã®Ïùº `-`) | Î™ÖÎ†πÏñ¥ (Ïù¥Ï§ë `--`)  | ÏÑ§Î™Ö                                                | ÏÇ¨Ïö© ÏòàÏãú                                      |
|:------------------|:---------------------|:----------------------------------------------------|:-----------------------------------------------|
| -A               | --append            | Ï≤¥Ïù∏Ïùò ÎÅùÏóê Í∑úÏπôÏùÑ Ï∂îÍ∞ÄÌï©ÎãàÎã§.                      | iptables -A INPUT -s 192.168.0.1 -j ACCEPT    |
| -D               | --delete            | Ï≤¥Ïù∏Ïùò Í∑úÏπôÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§.                          | iptables -D INPUT 1                           |
| -I               | --insert            | Ï≤¥Ïù∏Ïùò ÌäπÏ†ï ÏúÑÏπòÏóê Í∑úÏπôÏùÑ ÏÇΩÏûÖÌï©ÎãàÎã§.               | iptables -I INPUT 1 -s 192.168.0.1 -j ACCEPT  |
| -R               | --replace           | Ï≤¥Ïù∏Ïùò ÌäπÏ†ï ÏúÑÏπòÏóê ÏûàÎäî Í∑úÏπôÏùÑ ÎåÄÏ≤¥Ìï©ÎãàÎã§.          | iptables -R INPUT 1 -s 192.168.0.1 -j ACCEPT  |
| -L               | --list              | Ï≤¥Ïù∏Ïùò Í∑úÏπô Î™©Î°ùÏùÑ Ï∂úÎ†•Ìï©ÎãàÎã§.                      | iptables -L                                   |
| -F               | --flush             | Ï≤¥Ïù∏Ïùò Î™®Îì† Í∑úÏπôÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§.                      | iptables -F                                   |
| -X               | --delete-chain      | Î™®Îì† ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ï≤¥Ïù∏ÏùÑ ÏÇ≠Ï†úÌï©ÎãàÎã§.                 | iptables -X                                   |
| -P               | --policy            | Ï≤¥Ïù∏Ïùò Í∏∞Î≥∏ Ï†ïÏ±ÖÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§.                      | iptables -P INPUT DROP                        |
| -N               | --new-chain         | ÏÉàÎ°úÏö¥ ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ï≤¥Ïù∏ÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§.               | iptables -N my_chain                          |
| -E               | --rename-chain      | ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ï≤¥Ïù∏Ïùò Ïù¥Î¶ÑÏùÑ Î≥ÄÍ≤ΩÌï©ÎãàÎã§.               | iptables -E old_chain new_chain               |
| -p               | --protocol          | Ìå®ÌÇ∑Ïùò ÌîÑÎ°úÌÜ†ÏΩúÏùÑ ÏßÄÏ†ïÌï©ÎãàÎã§.                       | iptables -A INPUT -p tcp                      |
| -s               | --source            | ÏÜåÏä§ IP Ï£ºÏÜåÎ•º ÏßÄÏ†ïÌï©ÎãàÎã§.                          | iptables -A INPUT -s 192.168.0.1              |
| -d               | --destination       | Î™©Ï†ÅÏßÄ IP Ï£ºÏÜåÎ•º ÏßÄÏ†ïÌï©ÎãàÎã§.                        | iptables -A INPUT -d 192.168.0.1              |
|                  | --dport             | Î™©Ï†ÅÏßÄ Ìè¨Ìä∏Î•º ÏßÄÏ†ïÌï©ÎãàÎã§.                           | iptables -A INPUT -p tcp --dport 80           |
|                  | --sport             | ÏÜåÏä§ Ìè¨Ìä∏Î•º ÏßÄÏ†ïÌï©ÎãàÎã§.                             | iptables -A INPUT -p tcp --sport 1024         |
| -i               | --in-interface      | ÏûÖÎ†• Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º ÏßÄÏ†ïÌï©ÎãàÎã§.                       | iptables -A INPUT -i eth0                     |
| -o               | --out-interface     | Ï∂úÎ†• Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º ÏßÄÏ†ïÌï©ÎãàÎã§.                       | iptables -A OUTPUT -o eth0                    |
| -m state         |                     | ÏÉÅÌÉú ÏùºÏπò Î™®ÎìàÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ìå®ÌÇ∑ ÏÉÅÌÉúÎ•º ÏßÄÏ†ïÌï©ÎãàÎã§.   | iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT |
|                  | --state             | Ìå®ÌÇ∑Ïùò ÏÉÅÌÉúÎ•º ÏßÄÏ†ïÌï©ÎãàÎã§ (NEW, ESTABLISHED, RELATED, INVALID). | iptables -A INPUT -m state --state NEW        |
| -j               | --jump              | Ìå®ÌÇ∑Ïù¥ ÏùºÏπòÌï† Í≤ΩÏö∞ Ïã§ÌñâÌï† ÌÉÄÍ≤üÏùÑ ÏßÄÏ†ïÌï©ÎãàÎã§ (ACCEPT, DROP Îì±). | iptables -A INPUT -j ACCEPT                   |
|                  | --icmp-type         | ICMP Ìå®ÌÇ∑Ïùò Ïú†ÌòïÏùÑ ÏßÄÏ†ïÌï©ÎãàÎã§.                       | iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT |
| -n               | --numeric           | IP Ï£ºÏÜåÏôÄ Ìè¨Ìä∏Î•º Ïà´Ïûê ÌòïÏãùÏúºÎ°ú Ï∂úÎ†•Ìï©ÎãàÎã§.           | iptables -L -n                                |
| -v               | --verbose           | ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥Î•º Ï∂úÎ†•Ìï©ÎãàÎã§.                            | iptables -L -v                                |
|                  | --line-numbers      | Í∞Å Í∑úÏπôÏùò Ï§Ñ Î≤àÌò∏Î•º ÌëúÏãúÌï©ÎãàÎã§.                      | iptables -L --line-numbers                    |
>
{: .important }

- Î∞©ÌôîÎ≤Ω Ï†ïÏ±Ö

| Policy ID | From      | To        | SIP           | SPORT    | DIP      | DPORT | SERVICE | Schedule  | Action    | NAT         | Logging     |
|:----------|:----------|:----------|:--------------|:---------|:---------|:------|:--------|:----------|:----------|:------------|:------------|
| 1         | Internal  | External  | all           | ALL      | all      | ALL   | ALL     | ‚è∞ always | ‚úÖ ACCEPT | ‚ùå Disabled | ‚úÖ ALL      |
| 2         | External  | Internal  | all           | ALL      | all      | 53<br>123 | DNS<br>NTP | ‚è∞ always | ‚úÖ ACCEPT | ‚ùå Disabled | ‚úÖ ALL      |
| 3         | External  | Internal  | all           | ALL      | 172.16.0.0/24 | 22   | SSH<br>PING | ‚è∞ always | ‚úÖ ACCEPT | ‚ùå Disabled | ‚úÖ ALL      |
| 4         | External  | Internal  | all           | ALL      | 10.1.0.0/24   | 22   | SSH     | ‚è∞ always | ‚úÖ ACCEPT | ‚ùå Disabled | ‚úÖ ALL      |
| 0         | any       | any       | all           | ALL      | all      | ALL   | ALL     | ‚è∞ always | üö´ DENY   | ‚ùå Disabled | ‚ùå Disabled |

- iptables Í∑úÏπô Î™©Î°ù Ï∂úÎ†•

```bash
sudo iptables -L --line-numbers -n -v
```

> iptablesÏóê ÏÑ§Ï†ïÎêú ÌòÑÏû¨ Í∑úÏπôÏùÑ ÏûêÏÑ∏Ìûà(list) Ï∂úÎ†•Ìï©ÎãàÎã§. 
> -L: Ï≤¥Ïù∏(chain)Ïùò Í∑úÏπô Î™©Î°ùÏùÑ Ï∂úÎ†•Ìï©ÎãàÎã§. 
> --line-numbers: Ï≤¥Ïù∏(chain)Ïùò Î≤àÌò∏ Î™©Î°ùÏùÑ Ï∂úÎ†•Ìï©ÎãàÎã§. 
> -n: IP Ï£ºÏÜåÏôÄ Ìè¨Ìä∏Î•º Ïà´Ïûê ÌòïÏãùÏúºÎ°ú Ï∂úÎ†•Ìï©ÎãàÎã§ (DNS Ï°∞ÌöåÎ•º ÌïòÏßÄ ÏïäÏùå). 
> -v: ÏÉÅÏÑ∏Ìïú(verbose) Ï†ïÎ≥¥Î•º Ï∂úÎ†•Ìï©ÎãàÎã§ (Ìå®ÌÇ∑Í≥º Î∞îÏù¥Ìä∏ Ïàò Ìè¨Ìï®). 
>
{: .important }

<details markdown="block">
  <summary>
    ÏΩîÎìú
  </summary>
  {: .text-delta .label .label-green }
  
```bash
Chain INPUT (policy ACCEPT 244 packets, 33556 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   68  7408 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0           
 1413  114K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:53
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp spt:53
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:123
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp spt:123
    1    64 ACCEPT     tcp  --  *      *       172.16.0.0/24        0.0.0.0/0            tcp dpt:22
    0     0 ACCEPT     tcp  --  *      *       10.1.0.0/24          0.0.0.0/0            tcp dpt:22
    0     0 ACCEPT     icmp --  *      *       172.16.0.0/24        0.0.0.0/0            icmptype 8
    0     0 LOG        tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22 LOG flags 0 level 7 prefix "iptables_SSH_accept: "
    0     0 LOG        tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:22 LOG flags 0 level 7 prefix "iptables_SSH_deny: "
  144 12526 LOG        all  --  *      *       0.0.0.0/0            0.0.0.0/0            LOG flags 0 level 7 prefix "iptables_INPUT_denied: "
  144 12526 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 LOG        all  --  *      *       0.0.0.0/0            0.0.0.0/0            LOG flags 0 level 7 prefix "iptables_FORWARD_denied: "
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 180 packets, 33234 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   68  7408 ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0           
  570 42607 ACCEPT     all  --  *      eth0    0.0.0.0/0            0.0.0.0/0           
  695  329K ACCEPT     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0           
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:53
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:53
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:123
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:123
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            172.16.0.0/24        tcp spt:22
    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            10.1.0.0/24          tcp spt:22
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            172.16.0.0/24        icmptype 0
    0     0 LOG        tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:22 LOG flags 0 level 7 prefix "iptables_SSH_accept: "
    0     0 LOG        tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:22 LOG flags 0 level 7 prefix "iptables_SSH_deny: "
   32  1920 LOG        all  --  *      *       0.0.0.0/0            0.0.0.0/0            LOG flags 0 level 7 prefix "iptables_OUTPUT_denied: "
   32  1920 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           
```

</details>


- `rc.firewall` Ïä§ÌÅ¨Î¶ΩÌä∏

```bash
bash /etc/rc.firewall
```

<details markdown="block">
  <summary>
    ÏΩîÎìú
  </summary>
  {: .text-delta .label .label-green }
  
```bash
echo '#!/usr/bin/bash

# Î™®Îì† Í∑úÏπô ÌîåÎü¨Ïãú
sudo iptables -F

# ÏÇ¨Ïö©Ïûê Ï†ïÏùò Ï≤¥Ïù∏ ÏÇ≠Ï†ú
sudo iptables -X

# Î£®ÌîÑÎ∞± Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Ïùò Ìä∏ÎûòÌîΩ ÌóàÏö©
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A OUTPUT -o lo -j ACCEPT

# eth0 Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Ïùò Ìä∏ÎûòÌîΩ ÌóàÏö©
sudo iptables -A OUTPUT -o eth0 -j ACCEPT

# eth1 Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Ïùò Ìä∏ÎûòÌîΩ ÌóàÏö©
sudo iptables -A OUTPUT -o eth1 -j ACCEPT

# eth0 ‚Üí eth1ÏúºÎ°ú Ìä∏ÎûòÌîΩ ÌóàÏö©
#sudo iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT

# eth1 ‚Üí eth0ÏúºÎ°ú Ìä∏ÎûòÌîΩ ÌóàÏö©
#sudo iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT

# Ïù¥ÎØ∏ ÌôïÎ¶ΩÎêú Ïó∞Í≤∞ Î∞è Í¥ÄÎ†® Ìä∏ÎûòÌîΩ ÌóàÏö©
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# ICMP(PING) Ìä∏ÎûòÌîΩ ÌóàÏö©
#sudo iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
#sudo iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT

# DNS Ìä∏ÎûòÌîΩ ÌóàÏö© (TCP/UDP Ìè¨Ìä∏ 53)
sudo iptables -A OUTPUT -p tcp --dport 53 -j ACCEPT
sudo iptables -A OUTPUT -p udp --dport 53 -j ACCEPT
sudo iptables -A INPUT -p tcp --sport 53 -j ACCEPT
sudo iptables -A INPUT -p udp --sport 53 -j ACCEPT

# NTP Ìä∏ÎûòÌîΩ ÌóàÏö© (TCP/UDP Ìè¨Ìä∏ 123)
sudo iptables -A OUTPUT -p tcp --dport 123 -j ACCEPT
sudo iptables -A OUTPUT -p udp --dport 123 -j ACCEPT
sudo iptables -A INPUT -p tcp --sport 123 -j ACCEPT
sudo iptables -A INPUT -p udp --sport 123 -j ACCEPT

# SSH(Ìè¨Ìä∏ 22) Ìä∏ÎûòÌîΩ ÌóàÏö©
#sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
#sudo iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT

# 10.1.0.0/24 Î∞è 172.16.0.0/24 ÎåÄÏó≠Ïùò SSH Î∞è PING ÏöîÏ≤≠ ÌóàÏö©
sudo iptables -A INPUT -s 172.16.0.0/24 -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -s 10.1.0.0/24 -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -s 172.16.0.0/24 -p icmp --icmp-type echo-request -j ACCEPT
sudo iptables -A INPUT -s 10.1.0.0/24 -p icmp --icmp-type echo-request -j ACCEPT
sudo iptables -A OUTPUT -d 172.16.0.0/24 -p tcp --sport 22 -j ACCEPT
sudo iptables -A OUTPUT -d 10.1.0.0/24 -p tcp --sport 22 -j ACCEPT
sudo iptables -A OUTPUT -d 172.16.0.0/24 -p icmp --icmp-type echo-reply -j ACCEPT
sudo iptables -A OUTPUT -d 10.1.0.0/24 -p icmp --icmp-type echo-reply -j ACCEPT

# SSH Ï†ëÍ∑º ÏãúÎèÑ Î°úÍπÖ (ÌóàÏö©Îêú Í≤ΩÏö∞)
sudo iptables -A INPUT -p tcp --dport 22 -j LOG --log-prefix "iptables_SSH_accept: " --log-level 7
sudo iptables -A OUTPUT -p tcp --sport 22 -j LOG --log-prefix "iptables_SSH_accept: " --log-level 7

# SSH Ï†ëÍ∑º ÏãúÎèÑ Î°úÍπÖ (Ï∞®Îã®Îêú Í≤ΩÏö∞)
sudo iptables -A INPUT -p tcp --dport 22 -j LOG --log-prefix "iptables_SSH_deny: " --log-level 7
sudo iptables -A OUTPUT -p tcp --sport 22 -j LOG --log-prefix "iptables_SSH_deny: " --log-level 7

# Î™®Îì† ÌóàÏö©ÎêòÏßÄ ÏïäÏùÄ Ìä∏ÎûòÌîΩ Î°úÍπÖ
sudo iptables -A INPUT -j LOG --log-prefix "iptables_INPUT_denied: " --log-level 7
sudo iptables -A FORWARD -j LOG --log-prefix "iptables_FORWARD_denied: " --log-level 7
sudo iptables -A OUTPUT -j LOG --log-prefix "iptables_OUTPUT_denied: " --log-level 7

# Î™®Îì† ÌóàÏö©ÎêòÏßÄ ÏïäÏùÄ Ìä∏ÎûòÌîΩ Í∏∞Î≥∏ Ï†ïÏ±ÖÏúºÎ°ú Ï∞®Îã®
sudo iptables -A INPUT -j DROP
sudo iptables -A FORWARD -j DROP
sudo iptables -A OUTPUT -j DROP' > rc.firewall
```

</details>

### iptables Ï†ÄÏû• Î∞è Î≥µÏõê Î™ÖÎ†πÏñ¥

- iptables Í∑úÏπô Ï†ÄÏû•

ÌòÑÏû¨ ÏÑ§Ï†ïÎêú iptables Í∑úÏπôÏùÑ ÌååÏùºÏóê Ï†ÄÏû•

```bash
iptables-save > iptables.rules
```

- iptables Í∑úÏπô Î≥µÏõê

`iptables.rules` ÌååÏùºÏóê Ï†ÄÏû•Îêú iptables Í∑úÏπôÏùÑ Î≥µÏõê

```bash
iptables-restore < iptables.rules
```
