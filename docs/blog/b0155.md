---
layout: default
title: Linux iptables
parent: Blog
grand_parent: Category
permalink: docs/category/blog/b0155
child_nav_order: desc
---

# Linux iptables ì‚¬ìš©ë²•

<details open markdown="block">
  <summary>
    Table of contents
  </summary>
  {: .no_toc .text-delta .label .label-green }
1. TOC
{:toc}
</details>

---

## ê°œìš”

> - Linux iptables ì‚¬ìš©ë²•
{: .new }

### iptables ì‚¬ìš©ë²•

> - `iptables` ì˜µì…˜
> 
| ëª…ë ¹ì–´ (ë‹¨ì¼ `-`) | ëª…ë ¹ì–´ (ì´ì¤‘ `--`)  | ì„¤ëª…                                                | ì‚¬ìš© ì˜ˆì‹œ                                      |
|:------------------|:---------------------|:----------------------------------------------------|:-----------------------------------------------|
| -A               | --append            | ì²´ì¸ì˜ ëì— ê·œì¹™ì„ ì¶”ê°€í•©ë‹ˆë‹¤.                      | iptables -A INPUT -s 192.168.0.1 -j ACCEPT    |
| -D               | --delete            | ì²´ì¸ì˜ ê·œì¹™ì„ ì‚­ì œí•©ë‹ˆë‹¤.                          | iptables -D INPUT 1                           |
| -I               | --insert            | ì²´ì¸ì˜ íŠ¹ì • ìœ„ì¹˜ì— ê·œì¹™ì„ ì‚½ì…í•©ë‹ˆë‹¤.               | iptables -I INPUT 1 -s 192.168.0.1 -j ACCEPT  |
| -R               | --replace           | ì²´ì¸ì˜ íŠ¹ì • ìœ„ì¹˜ì— ìˆëŠ” ê·œì¹™ì„ ëŒ€ì²´í•©ë‹ˆë‹¤.          | iptables -R INPUT 1 -s 192.168.0.1 -j ACCEPT  |
| -L               | --list              | ì²´ì¸ì˜ ê·œì¹™ ëª©ë¡ì„ ì¶œë ¥í•©ë‹ˆë‹¤.                      | iptables -L                                   |
| -F               | --flush             | ì²´ì¸ì˜ ëª¨ë“  ê·œì¹™ì„ ì‚­ì œí•©ë‹ˆë‹¤.                      | iptables -F                                   |
| -X               | --delete-chain      | ëª¨ë“  ì‚¬ìš©ì ì •ì˜ ì²´ì¸ì„ ì‚­ì œí•©ë‹ˆë‹¤.                 | iptables -X                                   |
| -P               | --policy            | ì²´ì¸ì˜ ê¸°ë³¸ ì •ì±…ì„ ì„¤ì •í•©ë‹ˆë‹¤.                      | iptables -P INPUT DROP                        |
| -N               | --new-chain         | ìƒˆë¡œìš´ ì‚¬ìš©ì ì •ì˜ ì²´ì¸ì„ ìƒì„±í•©ë‹ˆë‹¤.               | iptables -N my_chain                          |
| -E               | --rename-chain      | ì‚¬ìš©ì ì •ì˜ ì²´ì¸ì˜ ì´ë¦„ì„ ë³€ê²½í•©ë‹ˆë‹¤.               | iptables -E old_chain new_chain               |
| -p               | --protocol          | íŒ¨í‚·ì˜ í”„ë¡œí† ì½œì„ ì§€ì •í•©ë‹ˆë‹¤.                       | iptables -A INPUT -p tcp                      |
| -s               | --source            | ì†ŒìŠ¤ IP ì£¼ì†Œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.                          | iptables -A INPUT -s 192.168.0.1              |
| -d               | --destination       | ëª©ì ì§€ IP ì£¼ì†Œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.                        | iptables -A INPUT -d 192.168.0.1              |
|                  | --dport             | ëª©ì ì§€ í¬íŠ¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.                           | iptables -A INPUT -p tcp --dport 80           |
|                  | --sport             | ì†ŒìŠ¤ í¬íŠ¸ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.                             | iptables -A INPUT -p tcp --sport 1024         |
| -i               | --in-interface      | ì…ë ¥ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.                       | iptables -A INPUT -i eth0                     |
| -o               | --out-interface     | ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.                       | iptables -A OUTPUT -o eth0                    |
| -m state         |                     | ìƒíƒœ ì¼ì¹˜ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ íŒ¨í‚· ìƒíƒœë¥¼ ì§€ì •í•©ë‹ˆë‹¤.   | iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT |
|                  | --state             | íŒ¨í‚·ì˜ ìƒíƒœë¥¼ ì§€ì •í•©ë‹ˆë‹¤ (NEW, ESTABLISHED, RELATED, INVALID). | iptables -A INPUT -m state --state NEW        |
| -j               | --jump              | íŒ¨í‚·ì´ ì¼ì¹˜í•  ê²½ìš° ì‹¤í–‰í•  íƒ€ê²Ÿì„ ì§€ì •í•©ë‹ˆë‹¤ (ACCEPT, DROP ë“±). | iptables -A INPUT -j ACCEPT                   |
|                  | --icmp-type         | ICMP íŒ¨í‚·ì˜ ìœ í˜•ì„ ì§€ì •í•©ë‹ˆë‹¤.                       | iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT |
| -n               | --numeric           | IP ì£¼ì†Œì™€ í¬íŠ¸ë¥¼ ìˆ«ì í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.           | iptables -L -n                                |
| -v               | --verbose           | ìì„¸í•œ ì •ë³´ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.                            | iptables -L -v                                |
|                  | --line-numbers      | ê° ê·œì¹™ì˜ ì¤„ ë²ˆí˜¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.                      | iptables -L --line-numbers                    |
>
{: .important }

- ë°©í™”ë²½ ì •ì±…

| From      | To       | SIP           | SPORT    | DIP      | DPORT | SERVICE | Schedule  | Action    | NAT         | Logging     |
|:----------|:---------|:--------------|:---------|:---------|:------|:--------|:----------|:----------|:------------|:------------|
| lo        | any      | all           | ALL      | all      | ALL   | ALL     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any      | all           | ALL      | all      | ALL   | RELATED,ESTABLISHED | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any      | all           | 53       | all      | ALL   | DNS     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any      | all           | 123      | all      | ALL   | NTP     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| 172.16.0.0/24 | any  | all           | ALL      | all      | 22    | SSH     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| 10.1.0.0/24   | any  | all           | ALL      | all      | 22    | SSH     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| 172.16.0.0/24 | any  | all           | ALL      | all      | PING  | PING    | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any      | all           | ALL      | all      | 22    | SSH     | â° always | ğŸš« LOG and ACCEPT | âŒ Disabled | âœ… iptables_SSH_accept |
| any       | any      | all           | ALL      | all      | 22    | SSH     | â° always | ğŸš« LOG and ACCEPT | âŒ Disabled | âœ… iptables_SSH_deny |
| any       | any      | all           | ALL      | all      | ALL   | ALL     | â° always | ğŸš« LOG and DENY | âŒ Disabled | âœ… iptables_INPUT_denied |
| any       | any      | all           | ALL      | all      | ALL   | ALL     | â° always | ğŸš« DENY   | âŒ Disabled | âŒ Disabled |
| any       | any      | all           | ALL      | all      | ALL   | ALL     | â° always | ğŸš« LOG and DENY | âŒ Disabled | âœ… iptables_FORWARD_denied |
| any       | any      | all           | ALL      | all      | ALL   | ALL     | â° always | ğŸš« DENY   | âŒ Disabled | âŒ Disabled |
| any       | lo      | all           | ALL      | all      | ALL   | ALL     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | eth0    | all           | ALL      | all      | ALL   | ALL     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | eth1    | all           | ALL      | all      | ALL   | ALL     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any     | all           | ALL      | all      | ALL   | RELATED,ESTABLISHED | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any     | all           | ALL      | all      | 53    | DNS     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any     | all           | ALL      | all      | 123   | NTP     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | 172.16.0.0/24 | all      | 22      | all      | ALL   | SSH     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | 10.1.0.0/24   | all      | 22      | all      | ALL   | SSH     | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | 172.16.0.0/24 | all      | ALL     | all      | PING  | PING    | â° always | âœ… ACCEPT | âŒ Disabled | âŒ Disabled |
| any       | any     | all           | 22      | all      | ALL   | SSH     | â° always | ğŸš« LOG and ACCEPT | âŒ Disabled | âœ… iptables_SSH_accept |
| any       | any     | all           | 22      | all      | ALL   | SSH     | â° always | ğŸš« LOG and ACCEPT | âŒ Disabled | âœ… iptables_SSH_deny |
| any       | any     | all           | ALL     | all      | ALL   | ALL     | â° always | ğŸš« LOG and DENY | âŒ Disabled | âœ… iptables_OUTPUT_denied |


- `rc.firewall` ìŠ¤í¬ë¦½íŠ¸

```bash
bash /etc/rc.firewall
```

<details markdown="block">
  <summary>
    ì½”ë“œ
  </summary>
  {: .text-delta .label .label-green }
  
```bash
echo '#!/usr/bin/bash

# ëª¨ë“  ê·œì¹™ í”ŒëŸ¬ì‹œ
sudo iptables -F

# ì‚¬ìš©ì ì •ì˜ ì²´ì¸ ì‚­ì œ
sudo iptables -X

# ë£¨í”„ë°± ì¸í„°í˜ì´ìŠ¤ì˜ íŠ¸ë˜í”½ í—ˆìš©
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A OUTPUT -o lo -j ACCEPT

# eth0 ì¸í„°í˜ì´ìŠ¤ì˜ íŠ¸ë˜í”½ í—ˆìš©
sudo iptables -A OUTPUT -o eth0 -j ACCEPT

# eth1 ì¸í„°í˜ì´ìŠ¤ì˜ íŠ¸ë˜í”½ í—ˆìš©
sudo iptables -A OUTPUT -o eth1 -j ACCEPT

# eth0 â†’ eth1ìœ¼ë¡œ íŠ¸ë˜í”½ í—ˆìš©
#sudo iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT

# eth1 â†’ eth0ìœ¼ë¡œ íŠ¸ë˜í”½ í—ˆìš©
#sudo iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT

# ì´ë¯¸ í™•ë¦½ëœ ì—°ê²° ë° ê´€ë ¨ íŠ¸ë˜í”½ í—ˆìš©
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# ICMP(PING) íŠ¸ë˜í”½ í—ˆìš©
#sudo iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
#sudo iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT

# DNS íŠ¸ë˜í”½ í—ˆìš© (TCP/UDP í¬íŠ¸ 53)
sudo iptables -A OUTPUT -p tcp --dport 53 -j ACCEPT
sudo iptables -A OUTPUT -p udp --dport 53 -j ACCEPT
sudo iptables -A INPUT -p tcp --sport 53 -j ACCEPT
sudo iptables -A INPUT -p udp --sport 53 -j ACCEPT

# NTP íŠ¸ë˜í”½ í—ˆìš© (TCP/UDP í¬íŠ¸ 123)
sudo iptables -A OUTPUT -p tcp --dport 123 -j ACCEPT
sudo iptables -A OUTPUT -p udp --dport 123 -j ACCEPT
sudo iptables -A INPUT -p tcp --sport 123 -j ACCEPT
sudo iptables -A INPUT -p udp --sport 123 -j ACCEPT

# SSH(í¬íŠ¸ 22) íŠ¸ë˜í”½ í—ˆìš©
#sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT
#sudo iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT

# 10.1.0.0/24 ë° 172.16.0.0/24 ëŒ€ì—­ì˜ SSH ë° PING ìš”ì²­ í—ˆìš©
sudo iptables -A INPUT -s 172.16.0.0/24 -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -s 10.1.0.0/24 -p tcp --dport 22 -j ACCEPT
sudo iptables -A INPUT -s 172.16.0.0/24 -p icmp --icmp-type echo-request -j ACCEPT
sudo iptables -A INPUT -s 10.1.0.0/24 -p icmp --icmp-type echo-request -j ACCEPT
sudo iptables -A OUTPUT -d 172.16.0.0/24 -p tcp --sport 22 -j ACCEPT
sudo iptables -A OUTPUT -d 10.1.0.0/24 -p tcp --sport 22 -j ACCEPT
sudo iptables -A OUTPUT -d 172.16.0.0/24 -p icmp --icmp-type echo-reply -j ACCEPT
sudo iptables -A OUTPUT -d 10.1.0.0/24 -p icmp --icmp-type echo-reply -j ACCEPT

# SSH ì ‘ê·¼ ì‹œë„ ë¡œê¹… (í—ˆìš©ëœ ê²½ìš°)
sudo iptables -A INPUT -p tcp --dport 22 -j LOG --log-prefix "iptables_SSH_accept: " --log-level 7
sudo iptables -A OUTPUT -p tcp --sport 22 -j LOG --log-prefix "iptables_SSH_accept: " --log-level 7

# SSH ì ‘ê·¼ ì‹œë„ ë¡œê¹… (ì°¨ë‹¨ëœ ê²½ìš°)
sudo iptables -A INPUT -p tcp --dport 22 -j LOG --log-prefix "iptables_SSH_deny: " --log-level 7
sudo iptables -A OUTPUT -p tcp --sport 22 -j LOG --log-prefix "iptables_SSH_deny: " --log-level 7

# ëª¨ë“  í—ˆìš©ë˜ì§€ ì•Šì€ íŠ¸ë˜í”½ ë¡œê¹…
sudo iptables -A INPUT -j LOG --log-prefix "iptables_INPUT_denied: " --log-level 7
sudo iptables -A FORWARD -j LOG --log-prefix "iptables_FORWARD_denied: " --log-level 7
sudo iptables -A OUTPUT -j LOG --log-prefix "iptables_OUTPUT_denied: " --log-level 7

# ëª¨ë“  í—ˆìš©ë˜ì§€ ì•Šì€ íŠ¸ë˜í”½ ê¸°ë³¸ ì •ì±…ìœ¼ë¡œ ì°¨ë‹¨
sudo iptables -A INPUT -j DROP
sudo iptables -A FORWARD -j DROP
sudo iptables -A OUTPUT -j DROP' > rc.firewall
```

</details>


